{
    "client_name": "Client name",
    "commit_hash": "1cff704a4065256f30bb50858626aa7ef5552268",
    "date": "June 2021",
    "date_interval": "October 15 to November 15, 2020",
    "issues": [
        {
            "active_lock_reason": null,
            "assignee": null,
            "assignees": [],
            "author_association": "CONTRIBUTOR",
            "body": "**Description**\r\n\r\nA user can stake HALO tokens for HALOHALO tokens by calling the `enter` method.\r\n\r\nhttps://github.com/monoceros-alpha/review-halodao-rewards-2021-06/blob/625eb4d3d0f780cfe06bb3f44ccbbea37149bd8b/code/contracts/HaloHalo.sol#L23\r\n\r\nThe number of HALO tokens is retrieved:\r\n\r\nhttps://github.com/monoceros-alpha/review-halodao-rewards-2021-06/blob/625eb4d3d0f780cfe06bb3f44ccbbea37149bd8b/code/contracts/HaloHalo.sol#L27-L28\r\n\r\nNext, the total number of shares is retrieved, which matches the number of minted tokens:\r\n\r\nhttps://github.com/monoceros-alpha/review-halodao-rewards-2021-06/blob/625eb4d3d0f780cfe06bb3f44ccbbea37149bd8b/code/contracts/HaloHalo.sol#L29-L30\r\n\r\nIf this is the first time someone enters the stake, the conditional is true, and a ratio of 1:1 is minted based on the amount entering the contract.\r\n\r\nhttps://github.com/monoceros-alpha/review-halodao-rewards-2021-06/blob/625eb4d3d0f780cfe06bb3f44ccbbea37149bd8b/code/contracts/HaloHalo.sol#L31-L33\r\n\r\ni.e., An actor entering with 100 HALO tokens will receive 100 HALOHALO tokens.\r\n\r\nIf tokens were already minted and HALO tokens exist in the contract, a formula is used to calculate how many tokens should be minted.\r\n\r\nhttps://github.com/monoceros-alpha/review-halodao-rewards-2021-06/blob/625eb4d3d0f780cfe06bb3f44ccbbea37149bd8b/code/contracts/HaloHalo.sol#L35-L37\r\n\r\nLet's assume an actor is the first one to stake tokens in the contract. They send 100 HALO tokens to the contact. Because they are the first ones, the contract mints 1:1 tokens, effectively 100 HALOHALO tokens.\r\n\r\nThe second actor enters with 100 HALO too. This time, the formula is activated.\r\n\r\n$hh_{amount} = \\frac{h_{enter} * hh_{minted}}{h_{locked}}$\r\n\r\nA number of $hh_{amount} = 100$ get minted. \r\n\r\nThis is because the formula uses the amount of tokens which the user wants to lock ($h_{enter} = 100$), the number of tokens already minted ($hh_{minted} = 100$, from the previous user) and the total locked tokens in the contract ($h_{locked} = 100$).\r\n\r\nminted tokens = $\\frac{100 * 100}{100} = 100$\r\n\r\nIf everything works well, a ratio of 1:1 will always be respected. However, if anyone sends HALO tokens to the contract, the 1:1 ratio is forever changed for all users staking tokens.\r\n\r\nLet's assume that after the 2 users deposited 100 HALO tokens each, and they received 100 HALOHALO tokens, a malicious user sends 100 HALO tokens to the contract without calling `enter`, but by using the `transfer` method.\r\n\r\nWe should be aware of the current state of the contract right now.\r\n\r\n$hh_{minted} = 200$\r\n\r\n$h_{locked} = 300$\r\n\r\nThe number of $h_{locked}$ is equal to 300 because the actual balance of the token is retrieved by using the `balanceOf` method, not an internal accounting method.\r\n\r\nIf a 3rd user wants to lock 100 HALO tokens, a different ratio of HALOHALO tokens will be minted for them. Using the formula we obtain the number of minted tokens.\r\n\r\nMinted tokens = $\\frac{100 * 200}{300} = 66.66$\r\n\r\nThis allows a malicious actor to manipulate the ratio of minted tokens.\r\n\r\n**Recommendation**\r\n\r\nUse internal accounting to retrieve the number of locked tokens.\r\n\r\n",
            "closed_at": null,
            "comments": 0,
            "comments_url": "https://api.github.com/repos/monoceros-alpha/review-halodao-rewards-2021-06/issues/2/comments",
            "created_at": "2021-06-28T14:25:45Z",
            "events_url": "https://api.github.com/repos/monoceros-alpha/review-halodao-rewards-2021-06/issues/2/events",
            "html_url": "https://github.com/monoceros-alpha/review-halodao-rewards-2021-06/issues/2",
            "id": 931632555,
            "labels": [
                {
                    "color": "ff3b30",
                    "default": false,
                    "description": null,
                    "id": 3123486179,
                    "name": "Major",
                    "node_id": "MDU6TGFiZWwzMTIzNDg2MTc5",
                    "url": "https://api.github.com/repos/monoceros-alpha/review-halodao-rewards-2021-06/labels/Major"
                },
                {
                    "color": "667788",
                    "default": false,
                    "description": null,
                    "id": 3123486056,
                    "name": "Report",
                    "node_id": "MDU6TGFiZWwzMTIzNDg2MDU2",
                    "url": "https://api.github.com/repos/monoceros-alpha/review-halodao-rewards-2021-06/labels/Report"
                },
                {
                    "color": "6B08DC",
                    "default": false,
                    "description": null,
                    "id": 3123486234,
                    "name": "WIP",
                    "node_id": "MDU6TGFiZWwzMTIzNDg2MjM0",
                    "url": "https://api.github.com/repos/monoceros-alpha/review-halodao-rewards-2021-06/labels/WIP"
                }
            ],
            "labels_url": "https://api.github.com/repos/monoceros-alpha/review-halodao-rewards-2021-06/issues/2/labels{/name}",
            "locked": false,
            "milestone": null,
            "node_id": "MDU6SXNzdWU5MzE2MzI1NTU=",
            "number": 2,
            "performed_via_github_app": null,
            "repository_url": "https://api.github.com/repos/monoceros-alpha/review-halodao-rewards-2021-06",
            "state": "open",
            "title": "The number of minted tokens might not be the expected one",
            "updated_at": "2021-06-28T14:58:36Z",
            "url": "https://api.github.com/repos/monoceros-alpha/review-halodao-rewards-2021-06/issues/2",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/547012?v=4",
                "events_url": "https://api.github.com/users/cleanunicorn/events{/privacy}",
                "followers_url": "https://api.github.com/users/cleanunicorn/followers",
                "following_url": "https://api.github.com/users/cleanunicorn/following{/other_user}",
                "gists_url": "https://api.github.com/users/cleanunicorn/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/cleanunicorn",
                "id": 547012,
                "login": "cleanunicorn",
                "node_id": "MDQ6VXNlcjU0NzAxMg==",
                "organizations_url": "https://api.github.com/users/cleanunicorn/orgs",
                "received_events_url": "https://api.github.com/users/cleanunicorn/received_events",
                "repos_url": "https://api.github.com/users/cleanunicorn/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/cleanunicorn/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/cleanunicorn/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/cleanunicorn"
            }
        },
        {
            "active_lock_reason": null,
            "assignee": null,
            "assignees": [],
            "author_association": "CONTRIBUTOR",
            "body": "**Description**\r\n\r\nThe Halo token contract is set when the `HaloHalo` contract is deployed.\r\n\r\nhttps://github.com/monoceros-alpha/review-halodao-rewards-2021-06/blob/625eb4d3d0f780cfe06bb3f44ccbbea37149bd8b/code/contracts/HaloHalo.sol#L16\r\n\r\nThe `halo` variable is defined as a state variable.\r\n\r\nhttps://github.com/monoceros-alpha/review-halodao-rewards-2021-06/blob/625eb4d3d0f780cfe06bb3f44ccbbea37149bd8b/code/contracts/HaloHalo.sol#L10\r\n\r\nBecause this state variable is never changed, it can be defined as `immutable` for a significant gas cost.\r\n\r\n**Recommendation**\r\n\r\nSet `halo` as `immutable`.\r\n",
            "closed_at": null,
            "comments": 0,
            "comments_url": "https://api.github.com/repos/monoceros-alpha/review-halodao-rewards-2021-06/issues/1/comments",
            "created_at": "2021-06-28T12:26:35Z",
            "events_url": "https://api.github.com/repos/monoceros-alpha/review-halodao-rewards-2021-06/issues/1/events",
            "html_url": "https://github.com/monoceros-alpha/review-halodao-rewards-2021-06/issues/1",
            "id": 931517293,
            "labels": [
                {
                    "color": "FFCC00",
                    "default": false,
                    "description": null,
                    "id": 3123486139,
                    "name": "Minor",
                    "node_id": "MDU6TGFiZWwzMTIzNDg2MTM5",
                    "url": "https://api.github.com/repos/monoceros-alpha/review-halodao-rewards-2021-06/labels/Minor"
                },
                {
                    "color": "667788",
                    "default": false,
                    "description": null,
                    "id": 3123486056,
                    "name": "Report",
                    "node_id": "MDU6TGFiZWwzMTIzNDg2MDU2",
                    "url": "https://api.github.com/repos/monoceros-alpha/review-halodao-rewards-2021-06/labels/Report"
                }
            ],
            "labels_url": "https://api.github.com/repos/monoceros-alpha/review-halodao-rewards-2021-06/issues/1/labels{/name}",
            "locked": false,
            "milestone": null,
            "node_id": "MDU6SXNzdWU5MzE1MTcyOTM=",
            "number": 1,
            "performed_via_github_app": null,
            "repository_url": "https://api.github.com/repos/monoceros-alpha/review-halodao-rewards-2021-06",
            "state": "open",
            "title": "Can set immutable for `halo` in `HaloHalo`",
            "updated_at": "2021-06-28T12:26:58Z",
            "url": "https://api.github.com/repos/monoceros-alpha/review-halodao-rewards-2021-06/issues/1",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/547012?v=4",
                "events_url": "https://api.github.com/users/cleanunicorn/events{/privacy}",
                "followers_url": "https://api.github.com/users/cleanunicorn/followers",
                "following_url": "https://api.github.com/users/cleanunicorn/following{/other_user}",
                "gists_url": "https://api.github.com/users/cleanunicorn/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/cleanunicorn",
                "id": 547012,
                "login": "cleanunicorn",
                "node_id": "MDQ6VXNlcjU0NzAxMg==",
                "organizations_url": "https://api.github.com/users/cleanunicorn/orgs",
                "received_events_url": "https://api.github.com/users/cleanunicorn/received_events",
                "repos_url": "https://api.github.com/users/cleanunicorn/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/cleanunicorn/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/cleanunicorn/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/cleanunicorn"
            }
        }
    ],
    "person_days": "5",
    "project_name": "Project name",
    "review_period": "2 weeks",
    "source_repository": "https://github.com/HaloDAO/halo-rewards.git",
    "template": "./Readme.md.mustache"
}